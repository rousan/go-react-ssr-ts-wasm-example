options:
tasks:
  setup:
    run:
      - command: go install github.com/cosmtrek/air@latest
      - command: sudo npm install -g concurrently
  dev:client:
    run:
      - command: cd client && yarn dev && cd ..
  dev:server:
    run:
      - command: cd server && air && cd ..
  dev:
    run:
      - command: concurrently "tusk dev:client" "tusk dev:server"
  start:client:
    run:
      - command: cd client && yarn build && yarn start && cd ..
  start:server:
    run:
      - command: cd server && go run . && cd ..
  start:
    run:
      - command: concurrently "tusk start:client" "tusk start:server"
  tidy:server:
    run:
      - command: cd server && go mod tidy && cd ..
  tidy:wasm:
    run:
      - command: cd wasm && go mod tidy && cd ..
  tidy:
    run:
      - command: tusk tidy:server && tusk tidy:wasm
  up:
    run:
      - command: docker-compose kill
      - command: docker-compose up --no-deps --build
  up:detached:
    run:
      - command: docker-compose kill
      - command: docker-compose up -d --no-deps --build
  deploy:staging:
    run:
      - command: echo "Deploying on the prod server"
      - command: echo "Please update (if any) the .env files for the staging server by logging into the VPS, hit Enter once it's done:" && read confirmation
      - command: ssh root@neon.lab.rousan.io 'bash -s' <./deploy/run-inside-vps.sh staging
  deploy:prod:
    run:
      - command: echo "Deploying on the prod server"
      - command: echo "Please update (if any) the .env files for the prod server by logging into the VPS, hit Enter once it's done:" && read confirmation
      - command: ssh root@neon.lab.rousan.io 'bash -s' <./deploy/run-inside-vps.sh prod
